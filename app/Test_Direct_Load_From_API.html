<!DOCTYPE html>
<html>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>JSON to HTML</title>
<style>
    table {
            width: 100%;
            border-collapse: collapse;
        }
        th {
            background-color: #f3f2f1;
            color: black;
            padding: 10px;
        }
        tr{
            border-left: 1px solid black;
            border-right: 1px solid black;
        }
        td {
            padding: 10px;
            border-bottom: 1px solid #ddd;
            font-family: arial, sans-serif;
        }
</style>

<script>
    function showSelectedOptions(){

        var distfilter=document.getElementById('distfilter');
        var distfilter_selectedOption=dropdown1.options[dropdown1.selectedIndex].text

        var sort_type=document.getElementById('sortfilter');
        var sort_type_selected=sorttype.options[sorttype.selectedIndex].text

        console.log("DISTANCE_FILTER OPT "+String(distfilter_selectedOption))
        console.info("HELLO THERE RUNNING SELECTED OPTIONS")
        document.getElementById('opt1').value=distfilter_selectedOption;
        document.getElementById('opt1_attr').value=dropdown1.options[dropdown1.selectedIndex].value

        document.getElementById('sort_opt').value=sort_type_selected;

        //document.getElementById('opt1_attr').value=dropdown1.options[dropdown1.selectedIndex].value
    }
</script>

</head>
<body>
    
 

<h1>Actual Code</h1>


 <div id="CONTAINER_BLOCK">
    <div>
        <label for="distfilter">Distance requirement:</label>
        <select id="dropdown1" name="dropdown1">
            <option value="L2">Less than 2 miles</option>
            <option value="L5">Less than 5 miles</option>
            <option value="L10">Less than 10 miles</option>
            <option value="L15">Less than 15 miles</option>
            <option value="L25">Less than 25 miles</option>
            <option value="L50">Less than 50 miles</option>
            <option value="ALL">All results</option>
        </select>
    </div>     
    <div>
        <label for="sortfilter">Sort:</label>
        <select id="sorttype" name="sorttype">
            <option value="relevance">Relevance</option>
            <option value="distance">Distance</option>
            <option value="distance">Diversity</option>
            <option value="distance">Rerank</option>
        </select>
    </div>  
    <form id="jsonForm">
        <label for="userinput">Course:</label>
        <input type="text" id="userinput" name="userinput" title="location"><br><br>
        <label for="location">Location:</label>
        <input type="text" id="location" name="location" title="location"><br><br>
        
        <div class="form-group">
            <label for="online_content">Include Online Content?</label><br>
            <input type="checkbox" id="online_content" title="online_content" name="online_content" value="include online">
       </div>
       
       <input type="hidden" id="opt1" name="opt1">
       <input type="hidden" id="opt1_attr" name="opt1_attr">
       <input type="hidden" id="sort_opt" name="sort_opt">
       <button type="submit" class="btn btn-primary btn-custom" onclick=submitForm()>Search</button>
    </form>
    
      <div id ="custresponse"></div>
      <div id="outputdiv_api"></div>
      <script>
        function submitForm() {
            showSelectedOptions();
            const form = document.getElementById('jsonForm');
            const formData = new FormData(form);
            const jsonData = {};
    
            formData.forEach((value, key) => {
                jsonData[key] = value;
            });
            console.info("SUBMITTING HTTP REQUEST");
            event.preventDefault();
            fetch('http://localhost:5000/runvectorsearch', {            
                //mode: 'no-cors',
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                    ,'Access-Control-Allow-Origin': 'http://localhost:5000'
                    ,'Accept':'application/json'
                    ,'Access-Control-Allow-Headers': ['origin','content-type','accept']
                },
                body: JSON.stringify(jsonData)
            })
            .then(response => {
            if (!response.ok) {
                console.error('NETWORK ERROR');
                throw new Error('Network response was not ok');
            }
            console.log("RETURN");
            return response.json();
            })
            .then(data => {
              
              console.info('GETTING DATA');
              console.info(data);

              
              //console.info(response.data)
              const responseDiv = document.getElementById("custresponse");
              console.info('SETTING CUSTOM RESPONSE')
              //responseDiv.innerHTML = `<p>${JSON.stringify(data, null, 2)}</p>`
              const list_of_tables=document.getElementById('outputdiv_api');
              
              if(list_of_tables.children.length>0){
                
                  // clear previous results
                  while (list_of_tables.firstChild){
                            list_of_tables.removeChild(list_of_tables.lastChild);
                };
              }
              let payload=data['PAYLOAD']
              for (let itr=0; itr<payload.length;itr++){
                    console.log(itr)
                    var title=document.createTextNode('Course Name: '+payload[itr]['COURSE_NAME']);
                    var coursetype=document.createTextNode('Course type: '+payload[itr]['COURSE_TYPE']);
                    var distance=document.createTextNode('Distance: '+payload[itr]['DISTANCE']+' miles ('+payload[itr]['LOCATION_TOWN']+')');
                    var description=document.createTextNode('Description: '+payload[itr]['WHO_THIS_COURSE_IS_FOR']);
                    var duration=document.createTextNode('Course Duration: '+payload[itr]['DURATION']);
                    var deliverymode=document.createTextNode('Delivery Mode: '+payload[itr]['DURATION']);
                    var locationtown=document.createTextNode('Location: '+payload[itr]['LOCATION']);
                    var requirements=document.createTextNode('Requirements: '+payload[itr]['SKILLS_REQUIRED']);
                    var startdate=document.createTextNode('Start Date: '+payload[itr]['START_DATE'])
                    let vartable=document.createElement('table');
                    let keys=[//'COURSE_NAME',
                        'ENTRY_REQUIREMENTS',
                        'COURSE_TYPE',
                        'DELIVERY_MODE',
                        'LEVEL',
                        'DISTANCE',
                        'LOCATION_TOWN',
                        'EMPLOYER_NAME',
                        'PROVIDER_NAME',
                        'START_DATE',
                        'WHO_THIS_COURSE_IS_FOR'
                        ,'DURATION'
                        ,'score'
                    ];
                    console.log("HELLO THERE");
                    let hdr=vartable.createTHead();
                    let t1=document.createElement('th');
                    t1.textContent=payload[itr]['COURSE_NAME'];
                    console.log('COURSE '+payload[itr]['COURSE_NAME'])
                    //console.log("GET ELEM 1");
                    let t2=document.createElement('th');
                    //t2.textContent=payload[itr]['WEBSITE']  
                    //t2.textContent="TEST URL";
                    var clink=document.createElement('a');
                    clink.href=payload[itr]['WEBSITE'];
                    clink.textContent='Link to course';
                    //t2.innerHTML='<a href="'+url+'">Link to course</a>'
                    
                    t2.appendChild(clink);
                    hdr.appendChild(t1);
                    hdr.appendChild(t2);
                    for (let i =0; i<keys.length;i++){
                        let tr=vartable.insertRow();
                        var name=keys[i];
                        var value=payload[itr][keys[i]];
                        let v0=tr.insertCell(0);
                        let b=document.createElement('bf');
                        b.textContent=name;
                        v0.appendChild(b);
                        
                        let v1=tr.insertCell(1);
                        v1.textContent=value;
                    }
                   
                    
                    list_of_tables.appendChild(vartable);
                    list_of_tables.appendChild(document.createElement('br'));
                    
                } // end of for loop
                
            })
            .catch(error => {
            console.error('Error:', error);
            const responseDiv = document.getElementById('outputdiv_api');
            responseDiv.innerHTML = `<p style="color: red;">Custom Error: ${error.message}</p>`;
            })
        }
                
      </script>
 </div>
</body>
</html>
 


